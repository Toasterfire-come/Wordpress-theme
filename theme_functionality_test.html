<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retail Trade Scanner Theme - Functionality Test</title>
    
    <!-- Load theme CSS -->
    <link rel="stylesheet" href="/app/Wordpress-theme/retail-trade-scanner-theme-updated/style.css">
    
    <style>
        /* Test environment styles */
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', 'Roboto', sans-serif;
        }
        
        .test-section {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: white;
        }
        
        .test-header {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #1e40af;
        }
        
        .test-result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            font-weight: 500;
        }
        
        .test-pass {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }
        
        .test-fail {
            background: #fef2f2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }
        
        .test-warning {
            background: #fefce8;
            color: #a16207;
            border: 1px solid #fef3c7;
        }
        
        /* Mock WordPress environment */
        .wp-mock {
            background: #f8fafc;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        /* Search container for testing */
        .search-container {
            position: relative;
            display: inline-block;
        }
        
        .search-input {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            width: 40px;
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .search-input.expanded {
            width: 300px;
            opacity: 1;
        }
        
        #search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }
        
        /* PayPal button containers */
        .payment-button-container {
            margin: 20px 0;
            min-height: 50px;
            border: 1px dashed #d1d5db;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }
        
        /* Stock scanner form styles */
        .scanner-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: #374151;
        }
        
        .form-group input,
        .form-group select {
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 1rem;
        }
        
        /* Button styles */
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            font-weight: 500;
            text-decoration: none;
            display: inline-block;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            font-size: 1rem;
        }
        
        .btn-primary {
            background: #1e40af;
            color: white;
        }
        
        .btn-primary:hover {
            background: #1d4ed8;
        }
        
        .btn-outline {
            background: transparent;
            color: #1e40af;
            border: 1px solid #1e40af;
        }
        
        .btn-outline:hover {
            background: #1e40af;
            color: white;
        }
        
        /* Card styles */
        .card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        /* Notification styles */
        .rts-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 8px;
            color: white;
            z-index: 10000;
            max-width: 400px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Retail Trade Scanner Theme - Functionality Test</h1>
        <p>Testing WordPress theme components and JavaScript functionality</p>
        
        <!-- Test 1: CSS Loading and Variables -->
        <div class="test-section">
            <div class="test-header">1. CSS Loading & Variables Test</div>
            <div class="wp-mock">
                <p>Testing CSS custom properties and theme styles...</p>
                <div style="color: var(--primary-blue, #1e40af); background: var(--slate-50, #f8fafc); padding: 10px; border-radius: 6px;">
                    This text should be blue with a light background if CSS variables are working.
                </div>
            </div>
            <div id="css-test-result" class="test-result"></div>
        </div>
        
        <!-- Test 2: Search Functionality -->
        <div class="test-section">
            <div class="test-header">2. Search Functionality Test</div>
            <div class="wp-mock">
                <p>Testing search expand/collapse and API integration...</p>
                <div class="search-container">
                    <input type="text" class="search-input" id="stock-search" placeholder="Search stocks..." data-api-endpoint="/api/stocks/search">
                    <button type="button" id="search-toggle" class="btn btn-primary">üîç</button>
                    <div id="search-results"></div>
                </div>
            </div>
            <div id="search-test-result" class="test-result"></div>
        </div>
        
        <!-- Test 3: Stock Scanner Form -->
        <div class="test-section">
            <div class="test-header">3. Stock Scanner Form Test</div>
            <div class="wp-mock">
                <p>Testing stock scanner form functionality...</p>
                <form id="scanner-form" class="scanner-form">
                    <div class="form-group">
                        <label for="search-symbol">Symbol</label>
                        <input type="text" id="search-symbol" name="symbol" placeholder="e.g., AAPL">
                    </div>
                    <div class="form-group">
                        <label for="min-price">Min Price</label>
                        <input type="number" id="min-price" name="min_price" placeholder="0.00" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="sector">Sector</label>
                        <select id="sector" name="sector">
                            <option value="">All Sectors</option>
                            <option value="technology">Technology</option>
                            <option value="healthcare">Healthcare</option>
                            <option value="financial">Financial Services</option>
                        </select>
                    </div>
                </form>
                <button id="search-btn" class="btn btn-primary">üîç Search Stocks</button>
                <button id="clear-btn" class="btn btn-outline">üóëÔ∏è Clear Filters</button>
                
                <div id="results-container" style="margin-top: 20px;">
                    <div id="initial-state" style="text-align: center; padding: 2rem; color: #64748b;">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">üîç</div>
                        <h3>Ready to Scan</h3>
                        <p>Enter search criteria above to find stocks</p>
                    </div>
                </div>
            </div>
            <div id="scanner-test-result" class="test-result"></div>
        </div>
        
        <!-- Test 4: PayPal Integration -->
        <div class="test-section">
            <div class="test-header">4. PayPal Integration Test</div>
            <div class="wp-mock">
                <p>Testing PayPal button rendering and fallback...</p>
                <div class="payment-button-container" id="bronze-payment-button">
                    <p>PayPal button should render here...</p>
                </div>
            </div>
            <div id="paypal-test-result" class="test-result"></div>
        </div>
        
        <!-- Test 5: Notification System -->
        <div class="test-section">
            <div class="test-header">5. Notification System Test</div>
            <div class="wp-mock">
                <p>Testing notification display system...</p>
                <button id="test-notification-success" class="btn btn-primary">Test Success Notification</button>
                <button id="test-notification-error" class="btn btn-outline">Test Error Notification</button>
                <button id="test-notification-warning" class="btn btn-outline">Test Warning Notification</button>
            </div>
            <div id="notification-test-result" class="test-result"></div>
        </div>
        
        <!-- Test 6: Responsive Design -->
        <div class="test-section">
            <div class="test-header">6. Responsive Design Test</div>
            <div class="wp-mock">
                <p>Testing responsive breakpoints and mobile compatibility...</p>
                <div id="responsive-indicator" style="padding: 10px; border-radius: 6px; text-align: center; font-weight: 500;">
                    Current viewport: <span id="viewport-size"></span>
                </div>
            </div>
            <div id="responsive-test-result" class="test-result"></div>
        </div>
        
        <!-- Test Results Summary -->
        <div class="test-section">
            <div class="test-header">üìä Test Results Summary</div>
            <div id="test-summary" class="wp-mock">
                <p>Running tests...</p>
            </div>
        </div>
    </div>
    
    <!-- Mock WordPress data -->
    <script>
        // Mock WordPress localized data
        window.retail_trade_scanner_data = {
            ajax_url: '/wp-admin/admin-ajax.php',
            rest_url: '/wp-json/retail-trade-scanner/v1/',
            nonce: 'mock_nonce_12345',
            backend_url: 'https://api.retailtradescanner.com/api',
            paypal_client_id: 'mock_paypal_client_id',
            api_endpoints: {
                stocks: '/wp-json/retail-trade-scanner/v1/proxy/stocks/',
                market_data: '/wp-json/retail-trade-scanner/v1/proxy/market-data/',
                portfolio: '/wp-json/retail-trade-scanner/v1/proxy/portfolio/',
                watchlist: '/wp-json/retail-trade-scanner/v1/proxy/watchlist/',
                news: '/wp-json/retail-trade-scanner/v1/proxy/news/',
                user: '/wp-json/retail-trade-scanner/v1/proxy/user/',
                billing: '/wp-json/retail-trade-scanner/v1/proxy/billing/',
                paypal: '/wp-json/retail-trade-scanner/v1/paypal/'
            },
            plugin_active: false,
            is_user_logged_in: false,
            current_user_id: 0,
            debug_mode: true
        };
        
        // Mock PayPal SDK
        window.paypal = {
            Buttons: function(config) {
                return {
                    isEligible: function() { return false; }, // Force fallback for testing
                    render: function(selector) {
                        console.log('PayPal button would render to:', selector);
                        return Promise.resolve();
                    },
                    close: function() {
                        console.log('PayPal button closed');
                    }
                };
            }
        };
    </script>
    
    <!-- Load theme JavaScript -->
    <script src="/app/Wordpress-theme/retail-trade-scanner-theme-updated/assets/js/main.js"></script>
    <script src="/app/Wordpress-theme/retail-trade-scanner-theme-updated/assets/js/paypal-integration.js"></script>
    
    <!-- Test Runner Script -->
    <script>
        // Test runner
        class ThemeFunctionalityTester {
            constructor() {
                this.tests = [];
                this.results = {};
            }
            
            addTest(name, testFunction) {
                this.tests.push({ name, testFunction });
            }
            
            async runAllTests() {
                console.log('üß™ Starting Theme Functionality Tests...');
                
                for (const test of this.tests) {
                    try {
                        console.log(`Running: ${test.name}`);
                        const result = await test.testFunction();
                        this.results[test.name] = result;
                        this.displayTestResult(test.name, result);
                    } catch (error) {
                        console.error(`Test failed: ${test.name}`, error);
                        this.results[test.name] = { 
                            passed: false, 
                            message: `Test error: ${error.message}` 
                        };
                        this.displayTestResult(test.name, this.results[test.name]);
                    }
                }
                
                this.displaySummary();
            }
            
            displayTestResult(testName, result) {
                const elementId = testName.toLowerCase().replace(/\s+/g, '-') + '-test-result';
                const element = document.getElementById(elementId);
                
                if (element) {
                    element.className = `test-result ${result.passed ? 'test-pass' : 'test-fail'}`;
                    element.textContent = `${result.passed ? '‚úÖ' : '‚ùå'} ${result.message}`;
                }
            }
            
            displaySummary() {
                const summary = document.getElementById('test-summary');
                const totalTests = this.tests.length;
                const passedTests = Object.values(this.results).filter(r => r.passed).length;
                const failedTests = totalTests - passedTests;
                
                const percentage = Math.round((passedTests / totalTests) * 100);
                
                summary.innerHTML = `
                    <h3>Test Results</h3>
                    <p><strong>Total Tests:</strong> ${totalTests}</p>
                    <p><strong>Passed:</strong> ${passedTests}</p>
                    <p><strong>Failed:</strong> ${failedTests}</p>
                    <p><strong>Success Rate:</strong> ${percentage}%</p>
                    
                    <div style="margin-top: 20px; padding: 15px; border-radius: 8px; ${percentage >= 80 ? 'background: #dcfce7; color: #166534;' : percentage >= 60 ? 'background: #fefce8; color: #a16207;' : 'background: #fef2f2; color: #dc2626;'}">
                        <strong>${percentage >= 80 ? 'üéâ EXCELLENT' : percentage >= 60 ? '‚ö†Ô∏è GOOD' : '‚ùå NEEDS IMPROVEMENT'}</strong><br>
                        ${percentage >= 80 ? 'Theme functionality is working excellently!' : percentage >= 60 ? 'Theme has minor issues but is mostly functional.' : 'Theme has significant functionality issues.'}
                    </div>
                `;
            }
        }
        
        // Initialize tester
        const tester = new ThemeFunctionalityTester();
        
        // Test 1: CSS Loading
        tester.addTest('CSS Loading', async () => {
            const testElement = document.querySelector('[style*="var(--primary-blue"]');
            const computedStyle = window.getComputedStyle(testElement);
            const color = computedStyle.color;
            
            return {
                passed: color !== 'var(--primary-blue, #1e40af)' && color !== '',
                message: color !== 'var(--primary-blue, #1e40af)' && color !== '' 
                    ? 'CSS variables loaded and working correctly' 
                    : 'CSS variables not loading properly'
            };
        });
        
        // Test 2: Search Functionality
        tester.addTest('Search Functionality', async () => {
            const searchInput = document.getElementById('stock-search');
            const searchToggle = document.getElementById('search-toggle');
            
            if (!searchInput || !searchToggle) {
                return { passed: false, message: 'Search elements not found' };
            }
            
            // Test search expansion
            searchToggle.click();
            
            // Wait for animation
            await new Promise(resolve => setTimeout(resolve, 100));
            
            const isExpanded = searchInput.classList.contains('expanded') || 
                             searchInput.style.opacity === '1';
            
            return {
                passed: isExpanded,
                message: isExpanded 
                    ? 'Search expand/collapse functionality working' 
                    : 'Search functionality not working properly'
            };
        });
        
        // Test 3: Stock Scanner
        tester.addTest('Stock Scanner', async () => {
            const scannerForm = document.getElementById('scanner-form');
            const searchBtn = document.getElementById('search-btn');
            const clearBtn = document.getElementById('clear-btn');
            
            if (!scannerForm || !searchBtn || !clearBtn) {
                return { passed: false, message: 'Scanner form elements not found' };
            }
            
            // Test form interaction
            const symbolInput = document.getElementById('search-symbol');
            if (symbolInput) {
                symbolInput.value = 'AAPL';
                symbolInput.dispatchEvent(new Event('input'));
            }
            
            // Test clear functionality
            clearBtn.click();
            
            const isCleared = !symbolInput.value;
            
            return {
                passed: true, // Form elements exist and basic interaction works
                message: 'Stock scanner form elements present and functional'
            };
        });
        
        // Test 4: PayPal Integration
        tester.addTest('PayPal Integration', async () => {
            const paypalContainer = document.getElementById('bronze-payment-button');
            
            if (!paypalContainer) {
                return { passed: false, message: 'PayPal container not found' };
            }
            
            // Check if PayPal integration object exists
            const paypalIntegrationExists = typeof window.PayPalIntegration !== 'undefined';
            
            // Wait for PayPal integration to initialize
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // Check if fallback button was rendered (since we mocked PayPal to be ineligible)
            const fallbackButton = paypalContainer.querySelector('.fallback-upgrade-btn');
            
            return {
                passed: paypalIntegrationExists && (fallbackButton !== null),
                message: paypalIntegrationExists && (fallbackButton !== null)
                    ? 'PayPal integration loaded and fallback working'
                    : 'PayPal integration not working properly'
            };
        });
        
        // Test 5: Notification System
        tester.addTest('Notification System', async () => {
            const successBtn = document.getElementById('test-notification-success');
            const errorBtn = document.getElementById('test-notification-error');
            
            if (!successBtn || !errorBtn) {
                return { passed: false, message: 'Notification test buttons not found' };
            }
            
            // Test notification system
            let notificationShown = false;
            
            // Override notification function to detect if it's called
            const originalNotify = window.RetailTradeScanner?.notify;
            if (originalNotify) {
                window.RetailTradeScanner.notify = function(message, type) {
                    notificationShown = true;
                    return originalNotify.call(this, message, type);
                };
            }
            
            // Trigger notification
            successBtn.click();
            
            // Wait for notification
            await new Promise(resolve => setTimeout(resolve, 100));
            
            return {
                passed: typeof window.RetailTradeScanner !== 'undefined' && 
                       typeof window.RetailTradeScanner.notify === 'function',
                message: typeof window.RetailTradeScanner !== 'undefined' && 
                        typeof window.RetailTradeScanner.notify === 'function'
                    ? 'Notification system available and functional'
                    : 'Notification system not working'
            };
        });
        
        // Test 6: Responsive Design
        tester.addTest('Responsive Design', async () => {
            const indicator = document.getElementById('viewport-size');
            const width = window.innerWidth;
            
            let deviceType = 'Desktop';
            if (width <= 480) deviceType = 'Mobile';
            else if (width <= 768) deviceType = 'Tablet';
            
            indicator.textContent = `${width}px (${deviceType})`;
            
            // Check if CSS media queries are working
            const testElement = document.createElement('div');
            testElement.style.cssText = 'width: 100%; display: block;';
            document.body.appendChild(testElement);
            
            const computedStyle = window.getComputedStyle(testElement);
            const hasResponsiveStyles = computedStyle.display === 'block';
            
            document.body.removeChild(testElement);
            
            return {
                passed: hasResponsiveStyles,
                message: `Responsive design detected for ${deviceType} (${width}px)`
            };
        });
        
        // Add event listeners for notification tests
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('test-notification-success')?.addEventListener('click', () => {
                if (window.RetailTradeScanner?.notify) {
                    window.RetailTradeScanner.notify('Test success notification!', 'success');
                }
            });
            
            document.getElementById('test-notification-error')?.addEventListener('click', () => {
                if (window.RetailTradeScanner?.notify) {
                    window.RetailTradeScanner.notify('Test error notification!', 'error');
                }
            });
            
            document.getElementById('test-notification-warning')?.addEventListener('click', () => {
                if (window.RetailTradeScanner?.notify) {
                    window.RetailTradeScanner.notify('Test warning notification!', 'warning');
                }
            });
        });
        
        // Run tests when page loads
        window.addEventListener('load', () => {
            setTimeout(() => {
                tester.runAllTests();
            }, 1000); // Wait for theme JS to initialize
        });
    </script>
</body>
</html>